# 拼豆设计器 (Perler Bead Designer) Spec

## Why

用户需要一个跨平台的拼豆设计工具，能够管理已购买的拼豆库存，并将图片转换为拼豆设计图，自动计算所需拼豆数量，帮助用户更好地规划和完成拼豆作品。

## What Changes

- 创建Flutter桌面应用程序（支持macOS和Windows）
- 实现拼豆库存管理功能（导入/管理拼豆数量和颜色）
- 实现图片导入和自动转换为拼豆设计图功能
- 实现可配置的尺寸设置和拼豆数量计算
- 集成小型内置模型或插件支持自动生成设计

## Impact

- 新项目：完整的Flutter桌面应用程序
- 主要模块：
  - 库存管理模块
  - 图片处理模块
  - 设计编辑模块
  - 导出/打印模块

## ADDED Requirements

### Requirement: 拼豆库存管理

系统应提供拼豆库存管理功能，允许用户导入和管理已购买的拼豆信息。

#### Scenario: 导入拼豆库存

- **WHEN** 用户选择导入拼豆库存文件（CSV/JSON格式）
- **THEN** 系统解析文件并显示拼豆颜色代码和数量列表

#### Scenario: 手动添加拼豆

- **WHEN** 用户手动输入拼豆颜色代码和数量
- **THEN** 系统将新拼豆添加到库存列表中

#### Scenario: 更新库存数量

- **WHEN** 用户修改某个颜色的拼豆数量
- **THEN** 系统更新库存记录并保存

### Requirement: 图片导入与转换

系统应支持导入图片并自动转换为拼豆设计图。

#### Scenario: 导入图片

- **WHEN** 用户选择导入图片文件（PNG/JPG/JPEG格式）
- **THEN** 系统加载图片并显示预览

#### Scenario: 设置输出尺寸

- **WHEN** 用户设置目标拼豆板的尺寸（宽x高，单位：拼豆数量）
- **THEN** 系统根据设置调整图片转换参数

#### Scenario: 自动转换图片

- **WHEN** 用户点击转换按钮
- **THEN** 系统将图片像素映射到拼豆颜色，生成拼豆设计图

#### Scenario: 颜色匹配

- **WHEN** 系统进行图片转换时
- **THEN** 系统将图片颜色匹配到最接近的拼豆颜色库中的颜色

### Requirement: 设计编辑

系统应提供设计编辑功能，允许用户修改生成的拼豆设计。

#### Scenario: 编辑单个拼豆

- **WHEN** 用户点击设计图上的某个位置
- **THEN** 系统允许用户更改该位置的拼豆颜色或清空

#### Scenario: 显示拼豆数量统计

- **WHEN** 设计图完成或修改后
- **THEN** 系统自动计算并显示各颜色拼豆的需求数量

#### Scenario: 库存对比

- **WHEN** 用户查看拼豆需求统计
- **THEN** 系统显示库存数量与需求数量的对比，标识不足的颜色

### Requirement: 内置模型/插件支持

系统应支持通过内置模型或插件自动生成或优化拼豆设计。

#### Scenario: 使用内置模型

- **WHEN** 用户选择使用内置模型进行设计优化
- **THEN** 系统应用模型算法优化颜色匹配和设计效果

#### Scenario: 加载外部插件

- **WHEN** 用户加载外部插件
- **THEN** 系统验证并集成插件功能

### Requirement: 导出功能

系统应支持导出设计结果。

#### Scenario: 导出设计图

- **WHEN** 用户选择导出设计
- **THEN** 系统生成PNG/PDF格式的设计图文件

#### Scenario: 导出材料清单

- **WHEN** 用户选择导出材料清单
- **THEN** 系统生成包含颜色代码和数量的清单文件（CSV/PDF）

### Requirement: 拼豆颜色库

系统应内置标准拼豆颜色库。

#### Scenario: 显示颜色库

- **WHEN** 用户查看颜色库
- **THEN** 系统显示所有可用拼豆颜色及其代码

#### Scenario: 自定义颜色

- **WHEN** 用户添加自定义颜色
- **THEN** 系统将新颜色添加到颜色库中

## Technical Requirements

### 技术栈

- Flutter SDK (最新稳定版)
- Dart 语言
- 支持平台：macOS 10.14+, Windows 10+

### 核心依赖

- `image` - 图片处理
- `file_picker` - 文件选择
- `pdf` - PDF导出
- `shared_preferences` - 本地存储
- `provider` 或 `riverpod` - 状态管理

### 数据存储

- 本地JSON文件存储库存和设置
- SQLite数据库（可选，用于大量数据）

### UI/UX

- Material Design 3 风格
- 响应式布局
- 深色/浅色主题支持
